<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>SMISWS Client</title>
    <style type="text/css">
      html,
      body {
        height: 98%;
        padding: 0;
        margin-top: 0;
        margin-bottom: 0;
      }

      .ui-txt {
        width: 500px;
      }

      .ui-cntnr {
        padding-top: 10px;
      }

      .ui-cntnr > input {
        display: inline-block;
        margin-right: 10px;
      }

      .ui-ctnt {
        margin-top: 10px;
        border: 1px solid black;
        height: 70%;
        overflow: auto;
      }

      th,
      td {
        padding-top: 5px;
        padding-bottom: 5px;
        padding-left: 10px;
        padding-right: 10px;
        border-spacing: 1px;
      }
    </style>
  </head>

  <body>
    <h1>SMISWS Client</h1>
    <div class="ui-cntnr">
      <table>
        <tr>
          <td>Create Session with SMISWS Server:</td>
          <td>
            <input id="sendSess" type="button" value="Request Session" />
          </td>
        </tr>
        <tr>
          <td>Send Hearbeat:</td>
          <td>
            <input id="sendAck" type="button" value="Request Acknowledgment" />
          </td>
        </tr>
        <tr>
          <td>JSON message to send:</td>
          <td colspan="2">
            <input id="msg" type="text" class="ui-txt" />
          </td>
        </tr>
        <tr>
          <td></td>
          <td>
            <input id="send" type="button" value="Send" />
          </td>
        </tr>
        <tr>
          <td>Market Info:</td>
          <td>
            <input id="sendRM" type="button" value="Request Market Info" />
          </td>
        </tr>
        <tr>
          <td>Index Detail:</td>
          <td>
            <select id="optIndex">
              <option value="100">DSEX</option>
              <option value="101">DSE30</option>
              <option value="102">DSES</option>
              <option value="1816">DSMEX</option>
              <option value="1733">ATBX</option>
            </select>
          </td>
        </tr>
        <tr>
          <td></td>
          <td>
            <input id="sendIdxDet" type="button" value="Request Index Detail" />
          </td>
        </tr>
        <tr>
          <td>Market Trade:</td>
          <td>
            <input
              id="sendRF"
              type="button"
              value="Request Market Trade Info"
            />
          </td>
        </tr>
        <tr>
          <td>Board</td>
          <td>
            <select id="optBoard">
              <option value="100">MAIN</option>
              <option value="200">SME</option>
              <option value="300">ATB</option>
            </select>
          </td>
        </tr>
        <tr>
          <td>Group</td>
          <td>
            <select id="optGroup">
              <option value="0">All</option>
              <option value="1">Public</option>
              <option value="2">Block</option>
              <option value="3">Buy In</option>
              <option value="4">Debt</option>
              <option value="5">Buy Debt</option>
              <option value="6">Yield Debt</option>
              <option value="7">Alt Debt</option>
              <!-- <option value="8">Buy Back</option>
            <option value="9">Foreign</option> -->
            </select>
          </td>
        </tr>
        <tr>
          <td></td>
          <td>
            <input
              id="sendRQ"
              type="button"
              value="Request Sector Detail Info"
            />
          </td>
        </tr>
        <tr>
          <td></td>
          <td>
            <input id="sendRV" type="button" value="Request Sector Summary" />
          </td>
        </tr>
        <tr>
          <td>Status</td>
          <td>
            <select id="optStatus">
              <option value="U">Up</option>
              <option value="D">Down</option>
              <option value="C">Unchange</option>
              <option value="T">Untrade</option>
              <option value="S">Suspend</option>
              <option value="?">Unknown</option>
              <option value="A" selected>All</option>
            </select>
          </td>
        </tr>
        <tr>
          <td>Sort Order</td>
          <td>
            <select id="optSortOrder">
              <option value="0">Ascending</option>
              <option value="1">Descending</option>
            </select>
          </td>
        </tr>
        <tr>
          <td>Sort by</td>
          <td>
            <select id="optSortBy">
              <option value="0">StockName</option>
              <option value="1">StockCode</option>
              <option value="2">ClosePrice</option>
              <option value="3">LastDonePrice</option>
              <option value="4">Change</option>
              <option value="5">ChangePercent</option>
              <option value="6">VolumeTraded</option>
              <option value="7">BuyRate</option>
              <option value="8">StockLongName</option>
              <option value="10">ISIN</option>
              <option value="11">ValueTraded</option>
            </select>
          </td>
        </tr>
        <tr>
          <td></td>
          <td>
            <input id="sendSS" type="button" value="Search Stock" />
          </td>
        </tr>
        <tr>
          <td>Stock Group:</td>
          <td>
            <select id="optStockGroup" onchange="javascript:showStockGroup()">
              <option value="0">Active</option>
              <option value="1">Gainer</option>
              <option value="2">Gainer Percent</option>
              <option value="3">Loser</option>
              <option value="4">Loser Percent</option>
              <option value="23">Main Public</option>
              <option value="255">List Stock</option>
            </select>
          </td>
          <td>
            <input
              type="text"
              id="txtStockGroup"
              value="Stock Name..."
              style="display: none"
            />
          </td>
        </tr>
        <tr>
          <td></td>
          <td>
            <input id="sendRS" type="button" value="Request Stock Info" />
          </td>
        </tr>
        <tr>
          <td></td>
          <td>
            <input id="sendLI" type="button" value="Request Stock Ranking" />
          </td>
        </tr>
        <tr>
          <td>Stock:</td>
          <td>
            <input type="text" id="txtStock" />
          </td>
        </tr>
        <tr>
          <td></td>
          <td>
            <input id="sendRP" type="button" value="Request Market Depth" />
          </td>
        </tr>
      </table>
    </div>
    <div class="ui-cntnr">
      <section id="ctnt" class="ui-ctnt"></section>
    </div>
    <script>
      var wss = new WebSocket("ws://192.168.100.48:8001"); // stg

      wss.onmessage = function (e) {
        console.log("onmessage");
        console.log(e.data);
        dispCtnt(e.data);
      };

      wss.onopen = function (e) {
        console.log("onopen");
        console.log(e);
        dispCtnt("Connection established" + "<br>");
      };

      wss.onclose = function (e) {
        console.log("onclose");
        console.log(e);
        dispCtnt("Connection closed" + "<br>");
      };

      wss.onerror = function (e) {
        console.log("onerror");
        console.log(e);
      };
      // login
      document
        .getElementById("sendSess")
        .addEventListener("click", function () {
          console.log("mt:LG");
          clrCtnt();
          //	wss.send('{"data":{"14":"this is hash value","16":"Nichlas","37":4325,"64":196608,"65":3},"mt":"LG"}');
          //wss.send('{"data":{"14":"this is hash value","16":"mt010","37":4325,"271":"505ae561111b6bfd3fad9f3badb0d8ca200eefaf1dfbb2310f58d6c710acbbba","64":196608,"65":3},"mt":"LG"}');
          wss.send(
            '{"data":{"16":"mt010","37":4325,"271":"505ae561111b6bfd3fad9f3badb0d8ca200eefaf1dfbb2310f58d6c710acbbba","64":196608,"65":3},"mt":"LG"}'
          );
          setInterval(sendAck, 5000);
          clrReqTxt();
        });

      // acknowledgement
      document.getElementById("sendAck").addEventListener("click", function () {
        clrCtnt();
        sendAck();
        clrReqTxt();
      });

      // send JSON message
      document.getElementById("send").addEventListener("click", function () {
        clrCtnt();
        var msg = document.getElementById("msg");
        console.log(msg.value);
        if (msg !== null) wss.send(msg.value);
        clrReqTxt();
      });

      // market info
      document.getElementById("sendRM").addEventListener("click", function () {
        console.log("mt:RM");
        clrCtnt();
        wss.send('{"data":"X","mt":"RM"}');
        clrReqTxt();
      });

      // index detail on each minute
      document
        .getElementById("sendIdxDet")
        .addEventListener("click", function () {
          console.log("mt:RI");
          clrCtnt();
          let optIndexName = document.getElementById("optIndex");
          let idxVal = optIndexName[optIndexName.selectedIndex].value;
          console.log(idxVal);
          wss.send(`{"data":{"23":${idxVal},"24":0,"29":0},"mt":"RI"}`);
          clrReqTxt();
        });

      // market trade info
      document.getElementById("sendRF").addEventListener("click", function () {
        console.log("mt:RF");
        clrCtnt();
        wss.send('{"data":{"42":1},"mt":"RF"}');
        clrReqTxt();
      });

      // sector detail info
      document.getElementById("sendRQ").addEventListener("click", function () {
        console.log("mt:RQ");
        clrCtnt();

        let optBoardName = document.getElementById("optBoard");
        let optGroupName = document.getElementById("optGroup");

        let optBoardVal = optBoardName[optBoardName.selectedIndex].value;
        let optGroupVal = optGroupName[optGroupName.selectedIndex].value;

        if (optGroupVal == 0) {
          // all group of selected board is choosen
          wss.send(`{"data":{"6":${optBoardVal},"29":-1},"mt":"RQ"}`);
        } else {
          // find specific group under the board
          let secCode = parseInt(optBoardVal) + parseInt(optGroupVal);
          console.log(secCode);
          wss.send(`{"data":{"6":${secCode},"29":-1},"mt":"RQ"}`);
        }
        clrReqTxt();
      });

      // sector summary
      document.getElementById("sendRV").addEventListener("click", function () {
        console.log("mt:RV");
        clrCtnt();

        let optBoardName = document.getElementById("optBoard");
        let optGroupName = document.getElementById("optGroup");

        let optBoardVal = optBoardName[optBoardName.selectedIndex].value;
        let optGroupVal = optGroupName[optGroupName.selectedIndex].value;

        if (optGroupVal == 0) {
          // all group of selected board is choosen
          wss.send(`{"data":{"6":${optBoardVal}},"mt":"RV"}`);
        } else {
          // find specific group under the board
          let secCode = parseInt(optBoardVal) + parseInt(optGroupVal);
          console.log(secCode);
          wss.send(`{"data":{"6":${secCode}},"mt":"RV"}`);
        }
        clrReqTxt();
      });

      // stock info
      document.getElementById("sendRS").addEventListener("click", function () {
        console.log("mt:RS");
        clrCtnt();

        let optStockGroupName = document.getElementById("optStockGroup");
        let stockGroupVal =
          optStockGroupName[optStockGroupName.selectedIndex].value;
        console.log(stockGroupVal);
        if (stockGroupVal != 255) {
          wss.send(
            `{"data":{"20":${stockGroupVal},"52":0,"66":1,"67":1,"229":0,"21":[1],"60":[1],"69":[1]},"mt":"RS"}`
          );
        } else {
          let txtStockGroupName = document.getElementById("txtStockGroup");
          if (txtStockGroupName.value == "") {
            alert("Enter Stock Name");
            txtStockGroupName.focus();
            return;
          }
          wss.send(
            `{"data":{"20":${stockGroupVal},"52":0,"66":1,"67":1,"229":1,"2":["${txtStockGroupName.value}"],"21":[1],"60":[1],"69":[1]},"mt":"RS"}`
          );
        }
        clrReqTxt();
      });

      // stock ranking
      document.getElementById("sendLI").addEventListener("click", function () {
        console.log("mt:LI");
        clrCtnt();
        let optStockGroupName = document.getElementById("optStockGroup");
        let stockGroupVal =
          optStockGroupName[optStockGroupName.selectedIndex].value;
        console.log(stockGroupVal);
        if (stockGroupVal != 255) {
          //wss.send(`{"data":{"20":${stockGroupVal},"52":1,"66":1,"67":1,"229":0,"21":[0],"60":[0],"69":[0]},"mt":"LI"}`);
          wss.send(
            `{"data":{"20":${stockGroupVal},"52":1,"66":1,"67":1,"229":0},"mt":"LI"}`
          );
        } else {
          alert("This option is not valid for Stock Ranking");
          optStockGroupName.focus();
          return;
        }
        clrReqTxt();
      });

      // market depth
      document.getElementById("sendRP").addEventListener("click", function () {
        let txtStockName = document.getElementById("txtStock");
        if (txtStockName.value == "") {
          alert("Enter Stock Name");
          txtStockName.focus();
          return;
        }
        console.log("mt:RP");
        clrCtnt();
        wss.send(
          `{"data":{"66":122,"67":1,"2":"${txtStockName.value}"},"mt":"RP"}`
        );
        clrReqTxt();
      });

      // search stock
      document.getElementById("sendSS").addEventListener("click", function () {
        console.log("mt:SS");
        clrCtnt();

        let optBoardName = document.getElementById("optBoard");
        let optGroupName = document.getElementById("optGroup");

        let optBoardVal = optBoardName[optBoardName.selectedIndex].value;
        let optGroupVal = optGroupName[optGroupName.selectedIndex].value;
        let secCode = parseInt(optBoardVal) + parseInt(optGroupVal);

        let optStatusName = document.getElementById("optStatus");
        let optSortOrderName = document.getElementById("optSortOrder");
        let optSortByName = document.getElementById("optSortBy");

        let optStatusVal = optStatusName[optStatusName.selectedIndex].value;
        let optSortOrderVal =
          optSortOrderName[optSortOrderName.selectedIndex].value;
        let optSortByVal = optSortByName[optSortByName.selectedIndex].value;

        let searchCond2 = makeWord(optStatusVal, secCode);
        console.log(searchCond2);
        let searchCond3 = makeWord(
          parseInt(optSortOrderVal),
          parseInt(optSortByVal)
        );
        console.log(searchCond3);

        console.log(
          `{"data":{"66":144,"44":0,"45":0,"46":${searchCond2},"47":${searchCond3}},"mt":"SS"}`
        );
        wss.send(
          `{"data":{"66":144,"44":0,"45":0,"46":${searchCond2},"47":${searchCond3}},"mt":"SS"}`
        );
        clrReqTxt();
      });

      function sendAck() {
        console.log("mt:AC");
        wss.send('{"mt":"AC","data":{}}');
      }

      function clrCtnt() {
        var ctnt = document.getElementById("ctnt");
        if (ctnt !== null) ctnt.innerHTML = "";
      }

      function clrReqTxt() {
        var msg = document.getElementById("msg");
        if (msg !== null) msg.value = "";
      }

      function dispCtnt(d) {
        var ctnt = document.getElementById("ctnt");
        if (ctnt !== null) ctnt.innerHTML += d + "<br>";
      }

      function makeWord(loword, hiword) {
        console.log(loword);
        console.log(hiword);

        if (isNaN(loword)) loword = loword.charCodeAt(0);
        console.log(loword);

        hiword = hiword << 16;
        console.log(hiword);

        loword += hiword;
        console.log(loword);
        return loword;
      }

      function showStockGroup() {
        let optStockGroupName = document.getElementById("optStockGroup");
        let idxVal = optStockGroupName[optStockGroupName.selectedIndex].value;
        if (idxVal == 255) {
          document.getElementById("txtStockGroup").style.display = "block";
          document.getElementById("txtStockGroup").focus();
          document.getElementById("txtStockGroup").select();
        } else {
          document.getElementById("txtStockGroup").style.display = "none";
        }
      }
    </script>
  </body>
</html>
